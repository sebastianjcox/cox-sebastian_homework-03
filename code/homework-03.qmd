---
title: "homework-03"
author: "Sebastian Cox"
date: "2 June 2024"
format:
  html: 
    toc: true # includes a table of contents in rendered html format
execute: # for all code chunks
    warning: false # do not display warnings
    message: false # do not display messages
---

Forked repository: <https://github.com/sebastianjcox/cox-sebastian_homework-03>

Reading in packages and cleaning data
```{r}

# general use
library(tidyverse)
library(readxl)
library(here)
library(janitor)

# visualizing pairs
library(GGally)

# model selection
library(MuMIn)

# model predictions
library(ggeffects)

# model tables
library(gtsummary)
library(flextable)
library(modelsummary)

drought_exp <- read_xlsx(path = here("data", #reading in data
                                     "Valliere_etal_EcoApps_Data.xlsx"),
                         sheet = "First Harvest")

#cleaning data

drought_exp_clean <- drought_exp %>% 
  clean_names() %>% # nicer column names
  mutate(species_name = case_when( # adding column with species scientific names
    species == "ENCCAL" ~ "Encelia californica", # bush sunflower
    species == "ESCCAL" ~ "Eschscholzia californica", # California poppy
    species == "PENCEN" ~ "Penstemon centranthifolius", # Scarlet bugler
    species == "GRICAM" ~ "Grindelia camporum", # great valley gumweed
    species == "SALLEU" ~ "Salvia leucophylla", # Purple sage
    species == "STIPUL" ~ "Nasella pulchra", # Purple needlegrass
    species == "LOTSCO" ~ "Acmispon glaber" # deerweed
  )) %>% 
  relocate(species_name, .after = species) %>% # moving species_name column after species
  mutate(water_treatment = case_when( # adding column with full treatment names
    water == "WW" ~ "Well watered",
    water == "DS" ~ "Drought stressed"
  )) %>% 
  relocate(water_treatment, .after = water) # moving water_treatment column after water
```

Models
```{r}
#Null model
model0 <- lm(total_g ~ 1, 
             data = drought_exp_clean)
#Saturated model
model1 <- lm(total_g ~ sla + water_treatment + species_name,
             data = drought_exp_clean)
#Predictors: SLA & Water Treatment
model2 <- lm(total_g ~ sla + water_treatment,
             data = drought_exp_clean)
#Predictors: SLA & Species
model3 <- lm(total_g ~ sla + species_name,
             data = drought_exp_clean)
#Predictors: Water Treatment & Species
model4 <- lm(total_g ~ water_treatment + species_name,
             data = drought_exp_clean)

```

Comparing Models
```{r}
model.sel(model0,
          model1, 
          model2, 
          model3,
          model4)
```
*Model 4* has the lowest AIC. Now, we will examine the diagnostic plots to
see if it is viable.

```{r}
par(mfrow = c(2, 2)) #show the diagnostics as a 2x2 table
plot(model4)
```
The diagnostic plots look good: the residuals appear to be homoscedastic and
normally distributed, and it appears that there are not any outliers that would
impact the model predictions.

# Problem 1. Multiple linear regression: model selection and construction

**a) Comparing Models **


| Model Number | Predictors                    |
|--------------|-------------------------------|
| 0            | None                          |
| 1            | SLA, Species, Water Treatment |
| 2            | SLA, Water Treatment          |
| 3            | SLA, Species                  |
| 4            | Species, Water Treatment      |

: Model Numbers and Predictors {#tbl-letters}



**b) Statistical Methods**

To explore the influence of specific leaf area (mm^2^/g), water treatment 
(well-watered or drought-stressed), and species on plant mass, I created and 
compared multiple linear regression models. One model served as a baseline and 
contained no predictors, one contained all three predictors, the the three 
subsequent models contained each permutation of two of the predictors 
(see **Table 1** for details). In order to decide upon the model that best 
described how plant growth changes, I compared the Akaike Information Criterions
(AICs), which takes into account the accuracy of the model's predictions and its
complexity. The model with the lowest AIC was *Model 4*, which has species and 
water treatment as predictors. To ensure that *Model 4* adhered to linear model
assumptions, I analyzed Residual-Fitted and Scale-Location plots for 
homoscedasticity of residuals, a QQ plot for normality of residuals, and a 
Cook's distance plot for outliers. The diagnostic plots indicated that the model
conformed to the assumptions and was suitable for analysis.

**c) Visualization**

```{r}
#storing model predictions
model_preds <- ggpredict(model4, 
                         terms = c("water_treatment", 
                                   "species_name"))

ggplot(drought_exp_clean,
       aes(x = water_treatment,
           y = total_g,
           color = water_treatment
           )) +
  geom_point(
             size = 1,
             alpha = 0.2) +
  geom_line(data = model_preds, 
            aes(x = x, y = predicted, group = group), 
            color = "aquamarine4" ,
            size = 1,
            linetype = "dotted") +
  geom_line(data = model_preds, 
            aes(x = x, y = conf.low, group = group), 
            color = "darkblue" ,
            size = 0.5,
            linetype = "dotted") +
  geom_line(data = model_preds, 
            aes(x = x, y = conf.high, group = group), 
            size = 0.5,
             color = "darkblue",
            linetype = "dotted") +
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) +
  facet_wrap(~group) +
  labs(x = "Water Treatment",
       y = "Total Biomass (g)",
       title = "Figure 1: Total Plant Biomass in Different Water Treatments")+
  theme(legend.position = "none")
  

```
